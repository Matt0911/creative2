<!DOCTYPE HTML>
<head>
  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <link rel="stylesheet" type="text/css" href="creative2.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <title>Creative 2</title>
</head>

<body>
  <div class="container text-center">

    <h1 class="title">Star Wars Quiz</h1>
    <p id='main-page'>Choose a topic:</p>
    <div id='quiz-options'>
      <button id='people-btn' class="btn btn-success btn-lg">People</button>
      <button id='starships-btn' class="btn btn-success btn-lg">Starships</button>
      <button id='species-btn' class="btn btn-success btn-lg">Species</button>
      <button id='planets-btn' class="btn btn-success btn-lg">Planets</button>
    </div>

    <div id='quiz' style='display:none'>
      Quiz
    </div>
    <button id='next' class="next-btn btn btn-default btn-sm" style='display:none'>Next</button>

  </div>


  <script>
    var userSelection = '';

    var people = ['eye_color', 'hair_color', 'height', 'mass', 'skin_color'];
    var starships = ['cargo_capacity', 'manufacturer', 'length'];
    var species = ['average_height', 'average_lifespan', 'language', 'classification'];
    var planets = ['climate', 'diameter', 'terrain', 'population'];

    $(document).ready(function() {
      var numQuestions = 5;
      var questions = [];
      var questionsAsked = 0;
      var questionsCorrect = 0;

      function generateQ() {
        $.getJSON('http://swapi.co/api/' + userSelection + '/', function(data) {
          var index = Math.floor(Math.random() * data.results.length);
          var type;
          var attr;

          if (userSelection === 'people') {
            type = Math.floor(Math.random() * people.length);
            attr = people[type];
          }

          if (userSelection === 'starships') {
            type = Math.floor(Math.random() * starships.length);
            attr = starships[type];
          }

          if (userSelection === 'species') {
            type = Math.floor(Math.random() * species.length);
            attr = species[type];
          }

          if (userSelection === 'planets') {
            type = Math.floor(Math.random() * planets.length);
            attr = planets[type];
          }

          var clean_attr = attr.replace('_', ' ');
          var question = 'What is the ' + clean_attr + ' of ' + data.results[index].name + '?';
          var correct = data.results[index][attr];
          var incorrect = [];

          while (incorrect.length < 3) {
            var temp = Math.floor(Math.random() * data.results.length);
            if (temp !== index) {
              if (data.results[temp][attr] !== correct) incorrect.push(data.results[temp][attr]);
            }
          }

          questions.push({q: question, a: correct, w: incorrect});
          $('#quiz').append('<p>' + question + '</p>');
          $('#quiz').append('<button class=\'btn btn-default btn-block\' id=\'correct\'>' + correct + '</button>');
          for (var i = 0; i < 3; i++) {
            $('#quiz').append('<button class=\'incorrect btn btn-default btn-block\'>' + incorrect[i] + '</button>');
          }

          $('#correct').click(function() {
            $('#next').show();
            questionsCorrect++;
            questionsAsked++;
          });

          $('.incorrect').click(function() {
            $('#next').show();
            questionsAsked++;
          });
        })
      };

      function startQuiz() {
        generateQ();
        var count = 0;
        $('#quiz').show();
      }

      $('#people-btn').click(function() {
        userSelection = 'people';
        $('#main-page').hide();
        $('#quiz-options').hide();
        startQuiz();
      });

      $('#starships-btn').click(function() {
        userSelection = 'starships';
        $('#main-page').hide();
        $('#quiz-options').hide();
        startQuiz();
      });

      $('#species-btn').click(function() {
        userSelection = 'species';
        $('#main-page').hide();
        $('#quiz-options').hide();
        startQuiz();
      });

      $('#planets-btn').click(function() {
        userSelection = 'planets';
        $('#main-page').hide();
        $('#quiz-options').hide();
        startQuiz();
      });

      $('#next').click(function() {
        $('#quiz').html('');
        if (questionsAsked !== numQuestions) {
          generateQ();
          $('#next').hide();
        }
        else {
          $('#quiz').html('<p>You\'re score is ' + questionsCorrect + ' out of ' + questionsAsked + '</p>');
          $('#quiz').append('<p>Refresh the page to try a new quiz!');
          $('#next').hide();
        }
      });


    });
  </script>
</body>
